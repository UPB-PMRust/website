
# HydroSense

An ESP32-based irrigation controller written in Rust, using soil moisture + rain sensing and MQTT telemetry.

:::info


**Author:** Cătălina Nedelcu-Holtea (`catalina_nedelcu.holtea`)  
**GitHub Project Link:**

:::

## Description

<div style="text-align: justify;">
HydroSense is an ESP32-based irrigation controller written in Rust, designed to automate watering decisions using real sensor data. The system reads a soil moisture sensor and a rain sensor, then switches a 12 V water pump through an N-channel MOSFET stage when irrigation is needed. In parallel, it publishes status and measurements via MQTT, which enables remote monitoring and makes testing/debugging significantly easier.
</div>

## Motivation

<div style="text-align: justify;">
I am particularly interested in embedded and IoT systems because they connect software to the physical world in a direct and measurable way—through sensing, decision-making, and reliable control of real hardware. These concepts are fundamental to understanding many technologies we interact with daily, from smart home devices and environmental monitoring to agriculture/greenhouse automation and industrial control.
</div>

<div style="text-align: justify;">
At the same time, HydroSense started from a personal need. I genuinely enjoy taking care of plants, but watering often becomes a routine task that is easy to forget during busy periods. I have experienced situations where inconsistent watering led to plants drying out and dying. This project is my practical solution: a small, dependable system that handles watering based on actual conditions, not memory or fixed schedules.
</div>

## Architecture

![Architecture diagram](./architecture.svg)

### Main components

- **ESP32 (main controller + Wi-Fi):**  
  The ESP32 is responsible for the full control loop: it reads the soil moisture and rain sensors, decides whether irrigation is required, and controls the relay module that switches the pump. In parallel, it connects to Wi-Fi and communicates with an MQTT broker to publish telemetry and receive remote commands.

- **Soil moisture sensor (probe + LM393 module):**  
  The probe behaves like a variable resistor whose value changes with soil moisture. The LM393 board conditions the signal and provides two outputs:
  - **AO (analog output):** a continuous voltage that can be sampled by the ESP32 to obtain a real moisture level. Because the system uses Wi-Fi/MQTT, the analog output should be connected to an **ADC1 pin** (recommended) for stable readings.
  - **DO (digital output):** a comparator-based 0/1 signal generated by the LM393. The threshold is adjusted using the onboard potentiometer, and it can be used as a simple “dry/wet” detection input.

- **Rain sensor:**  
  Provides a rain/no-rain signal. This input is used as an additional condition to prevent watering when rain is detected.

- **Relay module:**  
  The relay acts as the power switching stage. It is driven by one ESP32 GPIO pin and electrically separates the low-voltage logic from the pump power line.

- **5 V water pump:**  
  The actuator that performs irrigation. It is powered from a dedicated 5 V supply and is switched ON/OFF through the relay module.

- **Tube (water delivery):**  
  Routes water from the pump to the plant/soil area.

- **MQTT broker + phone dashboard:**  
  The MQTT broker is the communication bridge between the device and the user interface. Telemetry is sent from the ESP32 to the broker, and the phone dashboard subscribes to it. The dashboard can also publish command messages that allow manual pump control.

### User interface

- **Monitoring (telemetry):**  
  The ESP32 publishes measurements and system state via MQTT (soil moisture level, rain status, pump state). This allows me to view the system status on my phone and validate behavior during testing.

- **Manual override:**  
  Although the system operates automatically, the pump can also be turned ON/OFF manually from the phone by sending an MQTT command. This is useful for exceptional situations and for controlled testing.

### Data flow summary

- Soil moisture sensor + rain sensor → ESP32 (measurements)  
- ESP32 → relay module → 5 V pump → tube (irrigation)  
- ESP32 ↔ MQTT broker ↔ phone dashboard (telemetry + manual control)

## Log 

### Week 10 - 16 Nov
- Decided on the overall hardware approach: ESP32 as controller + relay module for switching the pump (pump is not driven directly from GPIO).
- Identified the two power domains that must be handled correctly: 3.3 V logic (ESP32 + sensors) and 5 V load side (pump + relay).

### Week 17 - 23 Nov
- Drafted the first wiring plan for the system:
  - soil moisture sensor → ESP32 input,
  - rain sensor → ESP32 input,
  - ESP32 GPIO → relay IN,
  - relay contacts → pump power line.
- Started documenting basic safety constraints (common ground, separation of logic wiring from pump wiring, secure connections due to water).

### Week 24 Nov - 30 Nov
- Selected the soil moisture module type (probe + LM393 board) and documented AO vs DO behavior.
- Chosen an initial strategy for the first prototype: start with the simplest stable signal (DO threshold output), with the option to move to AO later if needed.
- Noted that the sensor module should be powered from 3.3 V to keep ESP32 inputs safe.

### Week 1 - 7 Dec
- Refined the relay wiring plan (control pin + power + COM/NO contacts for the pump).
- Checked relay logic assumptions (active HIGH vs active LOW) to avoid incorrect behavior when writing firmware.
- Sketched a minimal “first wiring test” plan: relay click test without pump, then pump test, then sensor gating.

### Week 8 - 14 Dec
- Defined the first version of the control logic :
  - soil dry AND no rain → pump ON,
  - soil wet OR rain detected → pump OFF.
- Planned MQTT usage at a high level (telemetry + command), but postponed exact topic/payload finalization until after basic wiring and sensor reads work reliably.

### Week 15 - 21 Dec
- Set up the repository documentation and added the initial project page structure (description, motivation, architecture).
- Created an architecture block diagram aligned with the current wiring plan (ESP32 ↔ sensors, ESP32 → relay → pump, MQTT ↔ phone).
- Consolidated the current pin/wiring assumptions in one place so hardware assembly can follow a single reference.


## Hardware

- **ESP32 DevKit V1 (ESP32-WROOM-32 module)**  
  The ESP32 is the main controller of HydroSense. It reads the sensors, runs the automatic watering logic, drives the pump switching stage, and provides Wi-Fi connectivity. Over Wi-Fi it communicates with an MQTT broker to publish measurements (telemetry) and receive optional manual ON/OFF commands.

- **Soil moisture sensor: YL-69 probe + YL-38 (LM393) module**  
  This is the common resistive soil moisture kit composed of a two-prong probe (YL-69) and a small conditioning board (YL-38) based on the LM393 comparator. In HydroSense it provides the soil moisture signal used to decide whether watering is required. The module exposes:
  - **AO (analog output)** for a continuous moisture-related voltage, and
  - **DO (digital output)** for a threshold-based dry/wet signal set via the onboard potentiometer.

- **Rain sensor: FC-37 rain plate + LM393 comparator module**  
  This module detects rain/water on the sensor plate and outputs a signal that indicates rainfall (analog and/or thresholded digital, depending on how it is used). In HydroSense it is used as a safety/logic input to prevent watering when rain is detected.

- **Relay module: 1-channel 5 V relay**  
  The relay module is the electrical switching stage between the ESP32 and the pump power line. The ESP32 drives the relay input pin with a GPIO signal, and the relay contacts switch the pump’s supply. This allows the pump to be controlled safely without driving the load directly from the microcontroller.

- **Water pump: mini DC submersible pump (5 V)**  
  The pump is the actuator that moves water from a container/reservoir into the tube. HydroSense turns it ON/OFF through the relay module based on soil moisture and rain status, or via manual override through MQTT.

- **Tube (silicone/PVC)**  
  Provides water delivery from the pump outlet to the plant/soil area. It is the physical interface that completes the irrigation path.


### Schematics

### Bill of materials

## Software




